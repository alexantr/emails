#!/usr/bin/env php
<?php

// job example: 0 12 * * * /path/to/emails/bin/cleaner > /dev/null 2>&1

$emails_path = __DIR__ . '/../inbox';

$older_than = 3600 * 24 * 2; // seconds

$items = scandir($emails_path);
$files = [];
foreach ($items as $item) {
    if (strpos($item, '.') === 0) {
        continue;
    }
    if (is_file($emails_path . '/' . $item) && preg_match('/\.eml$/', $item)) {
        $files[] = $item;
    }
}

foreach ($files as $one) {
    $full_one_path = "$emails_path/$one";
    if (is_file($full_one_path) && filemtime($full_one_path) < time() - $older_than) {
        @unlink($full_one_path);
    }
}
